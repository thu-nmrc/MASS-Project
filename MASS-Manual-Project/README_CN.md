# MASS_System

è¿™æ˜¯ MASS é¡¹ç›®çš„ä¸­æ–‡è¯´æ˜æ–‡æ¡£ï¼ˆREADMEï¼‰ã€‚è¯¥é¡¹ç›®ä¸ºä¸€ä¸ªè½»é‡çº§çš„æœ¬åœ°åŒ– LLM è¾…åŠ©ç³»ç»Ÿï¼ŒåŒ…å«å‰ç«¯ UIï¼ˆ`static/`ï¼‰ã€åç«¯è½»é‡ HTTP æœåŠ¡ï¼ˆ`server.py`ï¼‰ä»¥åŠç”¨äºæ„å»º Windows å¯æ‰§è¡Œæ–‡ä»¶çš„æ‰“åŒ…è„šæœ¬ï¼ˆ`build_exe.py`ï¼‰ã€‚

## ğŸ¯ ä½¿ç”¨åœºæ™¯
- ğŸ“ˆ **ç»æµæ¨¡æ‹Ÿ**ï¼šç«äº‰ã€å®šä»·ç­–ç•¥  
- ğŸ›ï¸ **æ”¿ç­–åˆ†æ**ï¼šæ”¿ç­–å½±å“è¯„ä¼°  
- ğŸ® **æ¸¸æˆ AI**ï¼šç­–ç•¥æµ‹è¯•ã€å¹³è¡¡è°ƒä¼˜  
- ğŸ”¬ **ç¤¾ä¼šå®éªŒ**ï¼šç¾¤ä½“è¡Œä¸ºç ”ç©¶  
- ğŸ’¼ **å•†ä¸šåœºæ™¯**ï¼šè°ˆåˆ¤ã€å±æœºåº”å¯¹
- ğŸ¢ **ç»„ç»‡ç®¡ç†**ï¼šå±‚çº§å†³ç­–ã€ä¿¡æ¯ä¼ é€’
- âš”ï¸ **å†›äº‹æ¨¡æ‹Ÿ**ï¼šæŒ‡æŒ¥é“¾ã€æˆ˜æœ¯åè°ƒ
- ğŸ›’ **é¡¾å®¢æ—…ç¨‹**ï¼šTouch Pointåˆ†æã€ä½“éªŒä¼˜åŒ–ï¼ˆNEW!ï¼‰
- ğŸ“‹ **é¡¹ç›®ç®¡ç†**ï¼šé˜¶æ®µæ¨è¿›ã€é‡Œç¨‹ç¢‘è¿½è¸ªï¼ˆNEW!ï¼‰

## ğŸ’¡ æœ€ä½³å®è·µ
1. **èƒŒæ™¯è§„åˆ™**ï¼šç¯å¢ƒã€çº¦æŸã€å†³ç­–/è¾“å‡ºæ ¼å¼ï¼ˆç†æƒ³æƒ…å†µä¸‹ >1000 tokens ä»¥ä¾¿ç¼“å­˜ï¼‰  
2. **Agent æç¤ºè¯**ï¼šè§’è‰²ã€ç›®æ ‡ã€ç‰¹å¾ã€å½“å‰çŠ¶æ€ï¼ˆ200â€“500 tokensï¼‰  
3. **çªå‘äº‹ä»¶**ï¼šåœ¨å…³é”®å›åˆè§¦å‘ï¼Œé‡åŒ–å½±å“ï¼Œæä¾›ä¸Šä¸‹æ–‡å’ŒæŒ‡å¯¼  
4. **æˆæœ¬æ§åˆ¶**ï¼šä»ä¾¿å®œçš„æ¨¡å‹å¼€å§‹ï¼›è°ƒæ•´ Agent æ•°é‡/å›åˆæ•°ï¼›è€ƒè™‘ç¼“å­˜


## ç›®å½•ç»“æ„ï¼ˆç®€è¦ï¼‰

- `server.py`ï¼šåç«¯ HTTP æœåŠ¡ï¼Œæš´éœ² `/api/*` æ¥å£ï¼ˆè¯¦è§ä¸‹æ–‡ï¼‰ã€‚
- `static/`ï¼šå‰ç«¯èµ„æºï¼ˆåŒ…å« `index.html`ã€`js/app.js` å’Œ `js/i18n.js`ï¼‰ã€‚
- `examples/`ï¼šè‹¥å¹²ç¤ºä¾‹åœºæ™¯ JSON ç”¨äºæ¼”ç¤ºæˆ–å¿«é€Ÿå¯¼å…¥ã€‚
- `exports/`ï¼šè¿è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„å¯¼å‡ºæ–‡ä»¶ï¼Œé»˜è®¤åŒ…å« `messages.csv`ã€‚
- `build_exe.py`ï¼šä½¿ç”¨ `pyinstaller` æ‰“åŒ…ä¸º Windows å¯æ‰§è¡Œã€‚
- `start.bat` / `start.sh`/`mass.exe`ï¼šå¯åŠ¨å¼€å‘æœåŠ¡å™¨çš„è„šæœ¬ç¤ºä¾‹ã€‚

## å¿«é€Ÿç®€ä»‹

æœ¬ä»“åº“å®ç°äº†ä¸€ä¸ªä»¥ OpenAI å…¼å®¹ API ä¸ºåç«¯çš„å¯¹è¯/Agent ç®¡ç†ç³»ç»Ÿã€‚å‰ç«¯ï¼ˆ`static/js/app.js`ï¼‰è´Ÿè´£ Agent ç®¡ç†ã€äº‹ä»¶æ§åˆ¶ã€å¯¼å‡ºä¸é…ç½®ä¿å­˜ï¼›åç«¯ï¼ˆ`server.py`ï¼‰è´Ÿè´£è½¬å‘è¯·æ±‚è‡³ LLMï¼ˆå…¼å®¹ OpenAI Chat Completions æ¥å£ï¼‰ã€é‡è¯•ç­–ç•¥å’Œå¯¼å‡ºï¼ˆCSV/Excelï¼‰ã€‚

## ä¸»è¦ç‰¹æ€§

- æ”¯æŒå¤š Agent é…ç½®ä¸è‡ªå®šä¹‰ APIï¼ˆper-agent custom APIï¼‰
- é‡è¯•æœºåˆ¶ï¼šå¯¹å¸¸è§ 429/5xx é”™è¯¯è¿›è¡Œé‡è¯•ï¼ˆå¯é…ç½®é‡è¯•æ¬¡æ•°ï¼‰
- å¯¼å‡ºæ”¯æŒï¼šCSVï¼ˆé»˜è®¤ï¼‰å’Œ Excelï¼ˆå¯é€‰ `openpyxl`ï¼‰
- å¯æ‰“åŒ…ä¸º Windows å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆé€šè¿‡ `pyinstaller` å’Œ `build_exe.py`ï¼‰

## ç¯å¢ƒä¸ä¾èµ–

- Python 3.7+ï¼ˆé¡¹ç›®åŸºäºæ ‡å‡†åº“ï¼ŒExcel å¯¼å‡ºä¾èµ– `openpyxl`ï¼‰
- è‹¥éœ€è¦æ‰“åŒ… Windows å¯æ‰§è¡Œï¼Œå®‰è£… `pyinstaller`ã€‚

å®‰è£…å¯é€‰ä¾èµ–ï¼š

```powershell
pip install -r requirements.txt
```

`requirements.txt` é€šå¸¸åŒ…å« `openpyxl` å’Œ `pyinstaller`ï¼ˆå¦‚æœéœ€è¦ Excel å¯¼å‡ºæˆ–æ‰“åŒ…ï¼‰ã€‚

## è¿è¡Œï¼ˆå¼€å‘æ¨¡å¼ï¼‰

åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼ŒWindows ä¸‹å¯ç›´æ¥è¿è¡Œï¼š

```powershell
# ç›´æ¥è¿è¡Œåç«¯å¼€å‘æœåŠ¡
python server.py
# æˆ–ä½¿ç”¨æä¾›çš„æ‰¹å¤„ç†è„šæœ¬ï¼ˆæ³¨æ„å¯èƒ½éœ€è¦ä¿®æ”¹è„šæœ¬ä¸­çš„ Python è·¯å¾„ï¼‰
start.bat
```

é»˜è®¤æœåŠ¡å™¨ç«¯å£ä¸º 8899ï¼ˆå¯é€šè¿‡ç¯å¢ƒå˜é‡ `MASS_PORT` ä¿®æ”¹ï¼Œå¦‚æœåœ¨ `start` è„šæœ¬æˆ– `server.py` ä¸­æœ‰è¦†ç›–ï¼Œè¯·ä»¥å®é™…ä»£ç ä¸ºå‡†ï¼‰ã€‚

å‰ç«¯é™æ€æ–‡ä»¶ä½äº `static/`ï¼Œæ‰“å¼€ `static/index.html` å³å¯è®¿é—®å‰ç«¯ç•Œé¢ï¼ˆè‹¥åç«¯åœ¨æœ¬æœºè¿è¡Œï¼Œåˆ™å‰ç«¯ä¼šé€šè¿‡ fetch è°ƒç”¨åç«¯çš„ `/api/*` æ¥å£ï¼‰ã€‚

## åç«¯ API æ¦‚è§ˆ

åç«¯ä¸»è¦æš´éœ²ä»¥ä¸‹æ¥å£ï¼ˆä»¥ `POST` è¯·æ±‚ä¸ºä¸»ï¼‰ï¼š

- `/api/config`ï¼šä¿å­˜/æ›´æ–°å…¨å±€é…ç½®ï¼ˆä¾‹å¦‚ `baseUrl`, `apiKey`, `modelName`, `multiApi`ï¼‰ã€‚
- `/api/test`ï¼šæµ‹è¯•è¿æ¥/API è°ƒç”¨çš„æ¥å£ï¼Œç”¨äºéªŒè¯ `baseUrl` ä¸ `apiKey` æ˜¯å¦å¯ç”¨ã€‚ç¤ºä¾‹è¯·æ±‚ä½“åŒ…å« `{ baseUrl, apiKey, model, messages }`ã€‚
- `/api/complete`ï¼šæ ¸å¿ƒçš„å¯¹è¯/å®Œæˆæ¥å£ï¼Œåç«¯å°†æ„å»ºå¹¶è½¬å‘ `{ model, messages }` åˆ° `baseUrl + '/chat/completions'`ï¼Œå¹¶è¿”å›åŒ…å« `status`, `json`, `raw`, `attempts` ç­‰å­—æ®µçš„å“åº”ã€‚
- `/api/save_message`ï¼šä¿å­˜å•æ¡æ¶ˆæ¯åˆ°å¯¼å‡ºè®°å½•ï¼ˆCSVï¼‰ã€‚
- `/api/export`ï¼šè¯»å– `exports/messages.csv` å¹¶è¿”å›å¯¼å‡ºçš„ CSV æ–‡ä»¶ï¼ˆé»˜è®¤ï¼‰ã€‚
- `/api/export_excel`ï¼šå°†å¯¼å‡ºè½¬æ¢ä¸º Excel æ–‡ä»¶ï¼ˆä¾èµ– `openpyxl`ï¼‰ã€‚

æ³¨æ„ï¼šåç«¯åœ¨è½¬å‘è¯·æ±‚æ—¶å®ç°äº†é‡è¯•ç­–ç•¥ï¼ˆå¸¸è§é‡è¯•ç ï¼š429ã€500ã€502ã€503ã€504ï¼‰ï¼Œå‰ç«¯å¯ä»¥é€šè¿‡ `maxRetries` é…ç½®ä¸åç«¯äº¤äº’å†³å®šé‡è¯•æ¬¡æ•°ã€‚

## å‰ç«¯æ¦‚è§ˆ

- `static/js/app.js`ï¼šå‰ç«¯ä¸»è¦ä¸šåŠ¡é€»è¾‘æ–‡ä»¶ï¼Œç®¡ç† Agent å¯¹è±¡ã€äº‹ä»¶ã€è¿è¡Œæ§åˆ¶ã€å¯¼å‡ºä¸é…ç½®ä¿å­˜/å¯¼å…¥ã€‚Agent å¯¹è±¡åŒ…å«å­—æ®µ `id, name, prompt, useCustomApi, customBaseUrl, customApiKey, customModel, subordinates, includeSubSubordinates, returnDefaultEnabled`ã€‚
- `static/js/i18n.js`ï¼šå›½é™…åŒ–æ–‡æœ¬ï¼ˆæ”¯æŒ `zh-CN` ä¸ `en`ï¼‰ï¼Œä¿®æ”¹ UI æ–‡æœ¬è¯·åŒæ­¥æ›´æ–°æ­¤æ–‡ä»¶ã€‚

ç¼“å­˜ä¸å¤š API æ¨¡å¼è¯´æ˜ï¼š

- å½“ `multiApi === false` ä¸” `disableCache === false` æ—¶ï¼Œå‰ç«¯ä¼šæŠŠèƒŒæ™¯è§„åˆ™ä½œä¸ºå¯ç¼“å­˜çš„ `system` æ¶ˆæ¯å‘é€ï¼ˆä½¿ç”¨ `cache_control` æ ‡è®°ï¼‰ã€‚å¯ç”¨å¤š API æ¨¡å¼ä¼šè‡ªåŠ¨ç¦ç”¨ç¼“å­˜ï¼ˆä¸¤è€…äº’æ–¥ï¼‰ã€‚

## ç¤ºä¾‹

ä»“åº“åŒ…å«å¤šä¸ªç¤ºä¾‹åœºæ™¯ï¼ˆ`examples/`ï¼‰ï¼Œä¾‹å¦‚ï¼š

- `scenario_simple_test.json`
- `scenario_with_events.json`

è¿™äº›ç¤ºä¾‹å¯ä»¥åœ¨å‰ç«¯ç•Œé¢ä¸­å¯¼å…¥ä»¥å¿«é€Ÿæ„é€ æµ‹è¯•åœºæ™¯ã€‚

API æµ‹è¯•è¯·æ±‚ç¤ºä¾‹ï¼ˆç”¨äº `/api/test`ï¼‰ï¼š

```json
POST /api/test
{
  "baseUrl": "https://api.openai.com/v1",
  "apiKey": "sk-...",
  "model": "gpt-4",
  "messages": [{"role":"system","content":"ping"},{"role":"user","content":"ping"}]
}
```

## å¯¼å‡ºä¸ CSV æ ¼å¼

- åç«¯ä¼šå°†äº¤äº’è®°å½•å†™å…¥ `exports/messages.csv`ï¼Œ`/api/export` è¯»å–è¯¥ CSV å¹¶ç”Ÿæˆ `export_{n}.csv` è¿”å›ç»™å‰ç«¯ã€‚
- Excel å¯¼å‡ºéœ€è¦ `openpyxl`ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ Excel åŠŸèƒ½ä¸å¯ç”¨ã€‚
- è¯·å‹¿éšæ„ä¿®æ”¹ CSV åˆ—é¡ºåºï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´ `export_csv` / `export_excel` ä¸å…¼å®¹å‰ç«¯å¯¼å‡ºé€»è¾‘ã€‚

## æ‰“åŒ…ä¸º Windows å¯æ‰§è¡Œ

åœ¨éœ€è¦å°†é¡¹ç›®æ‰“åŒ…ä¸ºå•æ–‡ä»¶/å¯ç§»æ¤ç‰ˆæœ¬æ—¶ï¼Œä½¿ç”¨ `pyinstaller`ï¼š

```powershell
pip install pyinstaller
python build_exe.py
```

`build_exe.py` ä¼šä½¿ç”¨ `pyinstaller` ç”Ÿæˆ Windows å¯æ‰§è¡Œæ–‡ä»¶ã€‚æ„å»ºç»“æœä¼šå†™å…¥ `build/` ç›®å½•ï¼ˆç¤ºä¾‹å·²åŒ…å« `build/MASS/`ï¼‰ã€‚

## ç»´æŠ¤ä¸æ‰©å±•å»ºè®®

- ä¿®æ”¹åç«¯æ¥å£æˆ–å“åº”æ ¼å¼å‰ï¼Œè¯·å…ˆåœ¨ `static/js/app.js` ä¸­å®šä½å¯¹åº” `fetch` ä½¿ç”¨å¤„å¹¶åŒæ­¥æ›´æ–°å‰ç«¯ã€‚
- å¢åŠ æ–°åç«¯ç«¯ç‚¹æ—¶ï¼Œè¯·åœ¨ `server.py` çš„ `RequestHandler.do_POST` ä¸­æ·»åŠ è·¯ç”±ï¼Œå¹¶æ›´æ–° `static/js/app.js` çš„ç›¸åº” `fetch` è°ƒç”¨ä¸é”™è¯¯æç¤ºã€‚
- è‹¥æ‰©å±• per-agent API åŠŸèƒ½ï¼Œéµå¾ªå‰ç«¯ `agent.useCustomApi` å­—æ®µä¸ UIï¼ˆ`editAgent` / `configAgentApi`ï¼‰ã€‚

## å¿«é€Ÿæ•…éšœæ’æŸ¥

- è‹¥åç«¯æ— æ³•è¿æ¥ LLMï¼Œæ£€æŸ¥ `baseUrl` ä¸ `apiKey` æ˜¯å¦æ­£ç¡®ï¼Œå¹¶å°è¯•è°ƒç”¨ `/api/test` æŸ¥çœ‹å…·ä½“é”™è¯¯ç ã€‚
- è‹¥å¯¼å‡º Excel æŠ¥é”™ï¼Œç¡®è®¤å·²å®‰è£… `openpyxl`ã€‚
- è‹¥æ‰“åŒ…å¤±è´¥ï¼Œè¯·ç¡®è®¤ `pyinstaller` ç‰ˆæœ¬å…¼å®¹å¹¶æŸ¥çœ‹ `build/` ä¸‹çš„æ—¥å¿—æ–‡ä»¶ã€‚


## ğŸ“š å­¦æœ¯å¼•ç”¨ï¼ˆå¼ºçƒˆå»ºè®®å­¦æœ¯ä½¿ç”¨ï¼‰

å¦‚æœæ‚¨åœ¨å­¦æœ¯æˆ–ç§‘å­¦ç ”ç©¶ä¸­ä½¿ç”¨æ­¤**æ–¹æ³•**æˆ–**è½¯ä»¶**ï¼Œè¯·å¼•ç”¨ï¼š

Hu, Xiaoli; Shen, Yang; You, Keke (2025).  
*Multi-Agent Social Simulation: An Experimental Framework for Language-Native Social Experiments.*  
Agents4Science 2025 Workshop (Stanford), October 22, 2025.  
Available at: https://openreview.net/forum?id=emsnDnmtYP#discussion

**BibTeX**
```bibtex
@inproceedings{HuShenYou2025MASS,
  author    = {Xiaoli Hu and Yang Shen and Keke You},
  title     = {Multi-Agent Social Simulation: An Experimental Framework for Language-Native Social Experiments},
  booktitle = {Agents4Science 2025 Workshop},
  address   = {Stanford},
  year      = {2025},
  month     = {October},
  url       = {https://openreview.net/forum?id=emsnDnmtYP#discussion}
}
```

ä»“åº“åŒ…å« `CITATION.cff`ï¼Œå¯è¢«å­¦æœ¯å¼•ç”¨å·¥å…·è‡ªåŠ¨è¯†åˆ«ã€‚

## ğŸ¤ è´¡çŒ®æŒ‡å—
æ¬¢è¿è´¡çŒ®â€”â€”è¯·æäº¤ pull requestã€‚

## ğŸ“„ è®¸å¯è¯
æœ¬é¡¹ç›®åŸºäº **MIT è®¸å¯è¯** å‘å¸ƒã€‚  
æºè‡ª **èƒ¡æ™“æ (Xiaoli Hu)** çš„ MASS é¡¹ç›®ã€‚  
è¯¦è§ [LICENSE](./LICENSE) æ–‡ä»¶ã€‚
